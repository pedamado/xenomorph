<!doctype html>
<html lang="pt-PT">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XenoMorph Web Analyzer â€” Mother</title>
    <!-- JetBrains Mono Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap"
      rel="stylesheet"
    />

    <style>
      /* XenoMorph Design System: "Mother" Aesthetic
           Colors: Smoke Black, Off-White, Matrix Green (Dimmed)
        */
      :root {
        --smoke-black: #0d0d0d;
        --off-white: #f5f5f5;
        --terminal-green: #4af626; /* A bit less "pure" green, more CRT-like */
        --muted-green: #2d5a27;
        --accent-red: #ff4d4d;
        --accent-yellow: #ffcc00;

        /* Type Scale - 1.25 (Major Third) */
        --fs-base: 1rem; /* 16px */
        --fs-h2: 1.25rem; /* 20px */
        --fs-h1: 1.563rem; /* 25px */
        --fs-small: 0.8rem;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background-color: var(--smoke-black);
        color: var(--off-white);
        font-family: "JetBrains Mono", monospace;
        line-height: 1.6;
        padding: 2.5rem;
        min-height: 100dvh;
      }

      header {
        border-bottom: 2px solid var(--terminal-green);
        padding-bottom: 1.5rem;
        margin-bottom: 3rem;
        position: relative;
      }

      header::after {
        content: "MU-TH-UR 6000 SYSTEM ONLINE";
        position: absolute;
        bottom: -25px;
        right: 0;
        font-size: 0.7rem;
        color: var(--muted-green);
      }

      h1 {
        font-size: var(--fs-h1);
        color: var(--terminal-green);
        text-transform: uppercase;
        letter-spacing: 2px;
        margin-bottom: 0.5rem;
      }

      h2 {
        font-size: var(--fs-h2);
        color: var(--off-white);
        font-weight: 300;
        opacity: 0.8;
      }

      /* Input Atom */
      .input-organism {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        margin-bottom: 4rem;
        max-width: 800px;
      }

      .input-row {
        display: flex;
        gap: 1rem;
      }

      input[type="text"] {
        flex-grow: 1;
        background: transparent;
        border: 1px solid var(--muted-green);
        color: var(--terminal-green);
        padding: 0.8rem;
        font-family: inherit;
        font-size: var(--fs-base);
        outline: none;
        transition: border-color 0.3s ease;
      }

      input[type="text"]:focus {
        border-color: var(--terminal-green);
      }

      button {
        background-color: var(--terminal-green);
        color: var(--smoke-black);
        border: none;
        padding: 0 1.5rem;
        font-family: inherit;
        font-weight: 800;
        text-transform: uppercase;
        cursor: pointer;
        transition: opacity 0.2s ease;
      }

      button:hover {
        opacity: 0.9;
      }

      /* Report Molecule */
      #summary-area {
        display: none;
        border: 1px solid var(--muted-green);
        background: rgba(45, 90, 39, 0.05);
        padding: 2rem;
        margin-bottom: 3rem;
      }

      #summary-area h3 {
        font-size: var(--fs-h2);
        margin-bottom: 1rem;
        color: var(--terminal-green);
      }

      /* Analysis Grid (Table) */
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: var(--fs-small);
      }

      th,
      td {
        border: 1px solid #222;
        padding: 1rem;
        text-align: left;
      }

      th {
        background-color: #111;
        color: var(--muted-green);
        text-transform: uppercase;
        font-weight: 400;
      }

      .status-optimal {
        color: var(--terminal-green);
      }
      .status-minor {
        color: var(--accent-yellow);
      }
      .status-major {
        color: var(--accent-red);
      }

      footer {
        margin-top: 5rem;
        padding-top: 2rem;
        border-top: 1px solid #222;
        font-size: 0.7rem;
        color: #444;
        display: flex;
        justify-content: space-between;
      }

      footer a {
        color: inherit;
      }

      /* Loader Overlay */
      #loader {
        display: none;
        position: fixed;
        top: 20px;
        right: 20px;
        color: var(--terminal-green);
        font-size: 0.8rem;
      }

      .blink {
        animation: blink 1s infinite;
      }
      @keyframes blink {
        50% {
          opacity: 0;
        }
      }
    </style>
  </head>
  <body>
    <div id="loader" class="blink">ACQUIRING SIGNAL...</div>

    <header>
      <h1>XenoMorph Web Analyzer</h1>
      <h2>
        Diagnostic tool for surviving the web-development evolution in an age of
        AI
      </h2>
    </header>

    <div class="input-organism">
      <label for="target-url">INPUT TARGET URI:</label>
      <div class="input-row">
        <input
          type="text"
          id="target-url"
          placeholder="https://pages.up.pt/~up345288/ex2/"
          value=""
        />
        <button id="btn-inspect">INSPECT</button>
      </div>
    </div>

    <div id="summary-area">
      <h3>DIAGNOSTIC SUMMARY: <span id="summary-grade">---</span></h3>
      <p id="summary-text">Waiting for data input...</p>
    </div>

    <table id="report-grid">
      <thead>
        <tr>
          <th>Feature / Requirement</th>
          <th>Fundamental (Basic)</th>
          <th>Optional (Advanced)</th>
        </tr>
      </thead>
      <tbody id="report-output">
        <!-- Data will be injected here -->
      </tbody>
    </table>

    <footer>
      <div>
        Developed by Pedro Amado (FBAUP / i2ADS / Ligatures) with Gemini 3 Pro.
        v0.1
      </div>
      <div>
        <a href="https://github.com/pedamado/xenomorph" target="_blank"
          >SOURCE_CODE</a
        >
        |
        <a href="https://pedamado.github.io/xenomorph/" target="_blank"
          >LIVE_STATION</a
        >
      </div>
    </footer>

    <script>
      /**
       * MOTHER CORE ENGINE
       * Phase 1 & 2: Parser + Hygiene
       */
      const btn = document.getElementById("btn-inspect");
      const loader = document.getElementById("loader");
      const output = document.getElementById("report-output");
      const summary = document.getElementById("summary-area");
      const summaryGrade = document.getElementById("summary-grade");
      const summaryText = document.getElementById("summary-text");

      btn.addEventListener("click", () => {
        const url = document.getElementById("target-url").value.trim();
        if (!url) return;
        startAnalysis(url);
      });

      async function startAnalysis(url) {
        loader.style.display = "block";
        output.innerHTML = '<tr><td colspan="3">SCANNING SECTOR...</td></tr>';

        try {
          // Using AllOrigins proxy to bypass CORS
          const proxy = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}&timestamp=${Date.now()}`;
          const response = await fetch(proxy);

          if (!response.ok) throw new Error("SIGNAL LOST: TARGET UNREACHABLE");

          const data = await response.json();
          if (!data.contents)
            throw new Error("EMPTY PAYLOAD: NO HTML DETECTED");

          const parser = new DOMParser();
          const doc = parser.parseFromString(data.contents, "text/html");

          performDiagnostic(url, doc, data.contents);
        } catch (err) {
          console.error(err);
          output.innerHTML = `<tr><td colspan="3" class="status-major">ERROR: ${err.message}</td></tr>`;
        } finally {
          loader.style.display = "none";
        }
      }

      function performDiagnostic(url, doc, rawHTML) {
        summary.style.display = "block";
        const results = [];

        // --- 1. Hygiene Checks ---
        const fileName = url.split("/").filter(Boolean).pop() || "index.html";
        const asciiValid = /^[a-z0-9._-]+$/i.test(fileName);
        results.push({
          feature: "File Naming (ASCII)",
          basic: asciiValid
            ? "Optimal"
            : "Major Issue: Non-ASCII characters detected",
          advanced: "Recommended: index.html",
          score: asciiValid ? 0 : 2,
        });

        // --- 2. Landmark Checks ---
        const landmarks = ["header", "nav", "main", "section", "footer"];
        landmarks.forEach((tag) => {
          const count = doc.querySelectorAll(tag).length;
          results.push({
            feature: `Landmark: <${tag}>`,
            basic: count > 0 ? "Detected" : "Missing",
            advanced: count > 1 ? `Multiple (${count})` : "N/A",
            score: count > 0 ? 0 : 1,
          });
        });

        // --- 3. Aria-Label Check (New Priority) ---
        const navs = doc.querySelectorAll("nav");
        let ariaNavStatus = "N/A (Single Nav)";
        let ariaNavScore = 0;
        if (navs.length > 1) {
          const missingAria = Array.from(navs).filter(
            (n) =>
              !n.getAttribute("aria-label") &&
              !n.getAttribute("aria-labelledby"),
          );
          if (missingAria.length > 0) {
            ariaNavStatus = "Major Issue: Multiple navs require aria-labels";
            ariaNavScore = 2;
          } else {
            ariaNavStatus = "Optimal: Aria-labels present";
          }
        }
        results.push({
          feature: "Landmark Identity (ARIA)",
          basic: ariaNavStatus,
          advanced: "Required for repetitive landmarks",
          score: ariaNavScore,
        });

        // --- 4. Alt Text Quality ---
        const images = doc.querySelectorAll("img");
        let imgStatus = "N/A (No Images)";
        let imgScore = 0;
        if (images.length > 0) {
          const badAlt = Array.from(images).filter((img) => {
            const alt = img.getAttribute("alt");
            return !alt || alt.length <= 3;
          });
          if (badAlt.length > 0) {
            imgStatus = `Minor Issue: ${badAlt.length} images have weak alt text`;
            imgScore = 1;
          } else {
            imgStatus = "Optimal: Descriptive Alt text found";
          }
        }
        results.push({
          feature: "Alt-Text Quality",
          basic: imgStatus,
          advanced: "Check for > 3 characters",
          score: imgScore,
        });

        // --- 5. Tidy Code Detection (Simple Heuristic) ---
        const hasIndentation =
          rawHTML.includes("\n  ") || rawHTML.includes("\n\t");
        results.push({
          feature: "Tidy Code (Indentation)",
          basic: hasIndentation
            ? "Optimal"
            : "Minor Issue: Code looks minified or unindented",
          advanced: "Verify Prettier usage",
          score: hasIndentation ? 0 : 1,
        });

        renderResults(results);
      }

      function renderResults(results) {
        output.innerHTML = "";
        let totalStrikes = 0;

        results.forEach((res) => {
          totalStrikes += res.score;
          const statusClass =
            res.score === 0
              ? "status-optimal"
              : res.score === 1
                ? "status-minor"
                : "status-major";

          const tr = document.createElement("tr");
          tr.innerHTML = `
                    <td>${res.feature}</td>
                    <td class="${statusClass}">${res.basic}</td>
                    <td>${res.advanced}</td>
                `;
          output.appendChild(tr);
        });

        // Calculate Grade
        const percentage = (totalStrikes / results.length) * 100;
        if (totalStrikes === 0) {
          summaryGrade.innerText = "OPTIMAL";
          summaryGrade.className = "status-optimal";
          summaryText.innerText =
            "Biological and technical parameters are within normal range. Code is evolutionarily sound.";
        } else if (percentage < 20) {
          summaryGrade.innerText = "MINOR ISSUES";
          summaryGrade.className = "status-minor";
          summaryText.innerText =
            "Minor structural decay detected. Recommend immediate cleanup to avoid system collapse.";
        } else {
          summaryGrade.innerText = "MAJOR ISSUES";
          summaryGrade.className = "status-major";
          summaryText.innerText =
            "Critical failure. Structural integrity compromised. Review HTML Semantics and Atomic modularity.";
        }
      }
    </script>
  </body>
</html>
